
# Practical Exercise: Setting Up and Configuring a Firewall on Raspberry Pi

## Objective
To learn how to install, configure, and manipulate firewall rules on a Raspberry Pi using the Uncomplicated Firewall (UFW).

## Materials Needed
- Raspberry Pi (Model 3 or 4 recommended)
- MicroSD card (16GB or larger) with Raspbian OS installed
- Power supply for Raspberry Pi
- HDMI cable and monitor (or a laptop with VNC viewer for remote access)
- Keyboard and mouse
- Ethernet cable or Wi-Fi dongle (if not using built-in Wi-Fi)

## Exercise Steps

### 1. Installing UFW

First, ensure your Raspberry Pi is updated and install UFW.

```bash
sudo apt-get update
sudo apt-get upgrade
sudo apt-get install ufw
```

### 2. Enabling UFW

Enable UFW to start the firewall with default settings.

```bash
sudo ufw enable
```

Verify the status of UFW.

```bash
sudo ufw status
```

### 3. Basic UFW Commands

Learn and use the basic commands for UFW.

- **Allow a Port:**
  Allow HTTP traffic on port 80.

  ```bash
  sudo ufw allow 80/tcp
  ```

- **Deny a Port:**
  Deny Telnet traffic on port 23.

  ```bash
  sudo ufw deny 23/tcp
  ```

- **Allow a Range of Ports:**
  Allow ports 1000 to 2000.

  ```bash
  sudo ufw allow 1000:2000/tcp
  ```

- **Allow a Specific IP Address:**
  Allow traffic from a specific IP address.

  ```bash
  sudo ufw allow from 192.168.1.100
  ```

- **Deny a Specific IP Address:**
  Deny traffic from a specific IP address.

  ```bash
  sudo ufw deny from 192.168.1.200
  ```

### 4. Advanced UFW Configuration

Explore more advanced configurations for specific scenarios.

- **Allowing Specific Services:**
  Allow SSH, HTTP, and HTTPS services.

  ```bash
  sudo ufw allow ssh
  sudo ufw allow http
  sudo ufw allow https
  ```

- **Restricting Access to Specific Subnets:**
  Allow SSH only from a specific subnet.

  ```bash
  sudo ufw allow from 192.168.1.0/24 to any port 22
  ```

- **Setting Default Policies:**
  Set default policies to deny all incoming traffic and allow all outgoing traffic.

  ```bash
  sudo ufw default deny incoming
  sudo ufw default allow outgoing
  ```

- **Resetting UFW Rules:**
  Reset UFW rules to default.

  ```bash
  sudo ufw reset
  ```

### 5. Testing the Firewall Rules

Verify the firewall rules by using network scanning tools like \`nmap\`.

- **Install Nmap:**
  ```bash
  sudo apt-get install nmap
  ```

- **Scan the Raspberry Pi:**
  Perform a basic scan on the Raspberry Pi IP address.

  ```bash
  nmap <Raspberry_Pi_IP>
  ```

  Check open ports and ensure that the rules you configured are enforced.

### 6. Exercise: Creating a Firewall Rule Set

Create a comprehensive set of firewall rules based on a given scenario.

**Scenario:**
You are setting up a Raspberry Pi to act as a small web server in your home network. The web server should be accessible only from the local network. SSH should be allowed from a specific IP address for remote management. All other ports should be closed.

- **Steps:**
  1. Allow HTTP (port 80) and HTTPS (port 443) traffic from the local network.
  2. Allow SSH (port 22) traffic from your management IP (e.g., 192.168.1.50).
  3. Deny all other incoming traffic.

  **Solution:**

  ```bash
  sudo ufw allow from 192.168.1.0/24 to any port 80
  sudo ufw allow from 192.168.1.0/24 to any port 443
  sudo ufw allow from 192.168.1.50 to any port 22
  sudo ufw default deny incoming
  sudo ufw default allow outgoing
  sudo ufw status verbose
  ```

  Verify the rules with \`sudo ufw status\`.

### 7. Exercise: Modifying and Deleting Firewall Rules

Learn how to modify existing rules and delete them if necessary.

- **Delete a Rule:**
  Identify the rule number for HTTP and delete it.

  ```bash
  sudo ufw status numbered
  sudo ufw delete <rule_number>
  ```

- **Modify a Rule:**
  Modify the SSH rule to allow access from another IP.

  ```bash
  sudo ufw delete allow from 192.168.1.50 to any port 22
  sudo ufw allow from 192.168.1.100 to any port 22
  ```

### Testing the Firewall Rules

To test the firewall rules, we can use a simple Python script to generate traffic and verify the rules using \`nmap\`.

**Python Script to Generate Traffic:**

```python
import socket

def generate_traffic(port):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        s.connect(("your_raspberry_pi_ip", port))
        print(f"Port {port} is open")
    except Exception as e:
        print(f"Port {port} is closed or blocked")
    finally:
        s.close()

ports_to_test = [22, 80, 443, 23]
for port in ports_to_test:
    generate_traffic(port)
```

Replace \`your_raspberry_pi_ip\` with the actual IP address of your Raspberry Pi.

Run this script on another machine in your network to test the configured firewall rules.

**Using Nmap to Verify Rules:**

```bash
nmap -p 22,80,443,23 <Raspberry_Pi_IP>
```

This command will scan the specified ports and show which ones are open or closed.

### Conclusion and Q&A

- Recap the exercises.
- Discuss any challenges faced during the exercises.
- Answer questions from the participants.

### Additional Resources
- Official Raspberry Pi documentation: [raspberrypi.org/documentation](https://www.raspberrypi.org/documentation/)
- Cybersecurity Basics: [cybersecurityventures.com](https://cybersecurityventures.com)
- IoT Security: [owasp.org/projects/iot-security-guidance/](https://owasp.org/projects/iot-security-guidance/)
